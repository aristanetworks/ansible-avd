{# eos - NTP Server #}
{% if ntp_server is arista.avd.defined %}
!
{%     if ntp_server.local_interface.interface is arista.avd.defined %}
{%         set ntp_int_cli = "ntp local-interface " %}
{%         if ntp_server.local_interface.vrf is arista.avd.defined and ntp_server.local_interface.vrf != 'default' %}
{%             set ntp_int_cli = ntp_int_cli ~ "vrf " ~ ntp_server.local_interface.vrf %}
{%         endif %}
{%         set ntp_int_cli = ntp_int_cli ~ " " ~ ntp_server.local_interface.interface %}
{{ ntp_int_cli }}
{%     endif %}
{%     for node in ntp_server.nodes %}
{%         set node_cli = "ntp server " %}
{%         if ntp_server.local_interface.vrf is arista.avd.defined and ntp_server.local_interface.vrf != 'default' %}
{%             set node_cli = node_cli ~ "vrf " ~ ntp_server.local_interface.vrf %}
{%         endif %}
{%         set node_cli = node_cli ~ " " ~ node %}
{%         if loop.first %}
{%             set node_cli = node_cli ~ " prefer" %}
{%         endif %}
{{ node_cli }}
{%     endfor %}
{%   if ntp_server.ntp_authenticate is defined and ntp_server.ntp_authenticate is true %}
ntp authenticate
{%         for key_identifier in ntp_server.ntp_authentication_keys | arista.avd.natural_sort %}
{%             set key_cli = "ntp authentication-key " ~ key_identifier %}
{%             set key_cli = key_cli ~ " " ~ ntp_server.ntp_authentication_keys[key_identifier].hash_algorithm %}
{%             set key_cli = key_cli ~ " " ~ ntp_server.ntp_authentication_keys[key_identifier].key %}
{{ key_cli }}
{%         endfor %}
{%         for trusted_key_id in ntp_server.ntp_trusted_keys | arista.avd.natural_sort %}
{%             if loop.first %}
{%                 set trusted_keys_cli = "ntp trusted-key " ~ trusted_key_id %}
{%             else %}
{%                 set trusted_keys_cli = trusted_keys_cli ~ ", " ~ trusted_key_id %}
{%             endif %}
{%         endfor %}
{{ trusted_keys_cli }}
{%     endif %}
{% endif %}
