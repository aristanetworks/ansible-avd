{# Management API #}
{% if management_api_http is defined and management_api_http is not none %}
management api http-commands
{%     if management_api_http.enable_https is defined and management_api_http.enable_https == true %}
{%     else %}
   no protocol https
{%     endif %}
{%     if management_api_http.enable_http is defined and management_api_http.enable_http == true %}
   protocol http
{%     endif %}
   no shutdown
{%     if management_api_http.enable_vrfs is defined %}
{%         for vrf in management_api_http.enable_vrfs | arista.avd.natural_sort %}
   !
   vrf {{ vrf }}
      no shutdown
{%             if management_api_http.enable_vrfs[vrf].access_group is defined and management_api_http.enable_vrfs[vrf].access_group is not none %}
      ip access-group {{ management_api_http.enable_vrfs[vrf].access_group }}
{%             endif %}      
{%         endfor %}
{%     endif %}
!
{% endif %}
{# Management console #}
{% if management_console is defined and management_console is not none %}
management console
{%     if management_console.idle_timeout is defined and management_console.idle_timeout is not none %}
   idle-timeout {{ management_console.idle_timeout }}
{%     endif %}
!
{% endif %}
{# Management ssh #}
{% if management_ssh is defined and management_ssh is not none %}
management ssh
{%     if management_ssh.access_groups is defined and management_console.access_groups is not none %}
{%         for access_group in management_ssh.access_groups %}
   ip access-group {{ access_group }} {% if management_ssh.access_groups[access_group].vrf is defined and management_ssh.access_groups[access_group].vrf is not none %}vrf {{ management_ssh.access_groups[access_group].vrf }} {% endif %}in   
{%         endfor %}
{%     endif %}
{%     if management_ssh.idle_timeout is defined and management_ssh.idle_timeout is not none %}
   idle-timeout {{ management_ssh.idle_timeout }}
{%     endif %}
{%     if management_ssh.enable is defined and management_ssh.enable == true %}
   no shutdown
{%     else %}
   shutdown   
{%     endif %}
   !
{%     if management_ssh.vrfs is defined and management_console.vrfs is not none %}
{%         for vrf in management_ssh.vrfs %}
   vrf {{ vrf }}
{%             if management_ssh.vrfs[vrf].enable is defined and management_ssh.vrfs[vrf].enable == true %}
      no shutdown
{%             else %}
      shutdown       
{%             endif %} 
{%         endfor %}   
{%     endif %}
!
{% endif %}