{# Compute number of leaf devices #}
{% set switch.number_l3leaf_nodes = 0 %}
{% for l3leaf_node_group in l3leaf.node_groups | arista.avd.natural_sort %}
{%      set switch.number_l3leaf_nodes = switch.number_l3leaf_nodes + l3leaf.node_groups[l3leaf_node_group].nodes|length %}
{% endfor %}
{# leaf overlay loopback interface #}
  Loopback0:
    description: EVPN_Overlay_Peering
{# Loopback logic: Super Spine + Spine + Leaf before Evpn Controller lo0#}
{% if super_spine is defined %}
    ip_address: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(switch.id + switch.number_l3leaf_nodes + spine.nodes + super_spine.nodes | length) }}/32
{% else %}
    ip_address: {{ overlay_loopback_network_summary | ipaddr('network') | ipmath(switch.id + switch.number_l3leaf_nodes + spine.nodes | length) }}/32
{% endif %}
{% if underlay_routing_protocol == "OSPF" %}
    ospf_area: {{ underlay_ospf_area }}
{% endif %}
{% if underlay_routing_protocol == "ISIS" %}
    isis_enable: EVPN_UNDERLAY
    isis_passive: true
{% endif %}
